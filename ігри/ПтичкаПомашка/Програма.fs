відкрити Бібліотека

ГрафичнеВікно.Ширина <- 288
ГрафичнеВікно.Висота <- 440

нехай фон = Фігури.ДодатиЗображення("bg.png")
нехай земля = Фігури.ДодатиЗображення("ground.png")
нехай цвірінькаюча_пташка = Фігури.ДодатиЗображення("bird_sing.png")
нехай труба1 = СписокЗображень.ЗавантажитиЗображення("tube1.png")
нехай труба2 = СписокЗображень.ЗавантажитиЗображення("tube2.png")
Фігури.Перемістити(земля, 0, 340)

/// Тип птиці
тип Птиця = { X:float; Y:float; VY:float; Жива:bool }
/// Відповісти на команди помахів
нехай помах (птиця:Птиця) = { птиця із VY = - System.Math.PI }
/// Застосовуємо гравітацію до птиці
нехай гравітація (птиця:Птиця) = { птиця із VY = птиця.VY + 0.1 }
/// Застосовуємо фізіку до птиці
нехай фізика (птиця:Птиця) = { птиця із Y = птиця.Y + птиця.VY }
/// Оновлюємо птицю с допомогою гравітації та фізіки
нехай оновити = гравітація >> фізика
 
/// Формує позиції труб рівня
нехай сгенеруватиРівень n =
   нехай rand = System.Random()
   [for i in 1..n -> 50+(i*150), 32+rand.Next(160)]

нехай рівень = сгенеруватиРівень 10

нехай труби =
   [for (x,y) in рівень ->
      нехай труба1 = Фігури.ДодатиЗображення(труба1)
      нехай труба2 = Фігури.ДодатиЗображення(труба2)
      Фігури.Перемістити(труба1,x,y-320)
      Фігури.Перемістити(труба2,x,y+100)
      (x,y), труба1, труба2]

нехай скролл = ref 0
нехай помашок = ref { X = 30.0; Y = 150.0; VY = 0.0; Жива=true }
нехай помашимною () = if (помашок.Value).Жива then помашок.Value <- помах помашок.Value

ГрафичнеВікно.КлавішаНатиснута <-    
    fun () -> if ГрафичнеВікно.ОстанняКнопка = "Space" then помашимною ()
ГрафичнеВікно.МишаДонизу <-
    fun () -> помашимною ()

доки true зробити
   помашок := оновити !помашок
   нехай птиця = !помашок
   Фігури.Перемістити(цвірінькаюча_пташка, птиця.X, птиця.Y)
   for ((x,y),труба1,труба2) in труби зробити
      Фігури.Перемістити(труба1, float (x + !скролл),float (y-320))
      Фігури.Перемістити(труба2, float (x + !скролл),float (y+100))
   Фігури.Перемістити(земля, !скролл % 48, 340)
   decr скролл  
   Програма.Затримка(20)
